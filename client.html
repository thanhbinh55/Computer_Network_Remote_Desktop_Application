<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>REMOTE_OPS // TERMINAL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE TERMINAL STYLES --- */
        :root {
            --bg-color: #0a0a0a;     /* N·ªÅn ƒëen s√¢u */
            --panel-bg: #0e1114;     /* N·ªÅn panel t·ªëi */
            --text-primary: #00ff41; /* Xanh l√° hacker c·ªï ƒëi·ªÉn */
            --text-accent: #00f7ff;  /* Xanh d∆∞∆°ng ƒëi·ªán t·ª≠ (Cyan) cho ti√™u ƒë·ªÅ/ƒëi·ªÉm nh·∫•n */
            --danger: #ff003c;       /* ƒê·ªè c·∫£nh b√°o s·∫Øc n√©t */
            --border-glow: 0 0 4px rgba(0, 255, 65, 0.3);
        }

        body {
            font-family: 'Fira Code', 'Roboto Mono', Consolas, monospace; /* Font ƒë∆°n s·∫Øc l√† b·∫Øt bu·ªôc */
            background: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            /* Hi·ªáu ·ª©ng n·ªÅn v√¢n scanline nh·∫π */
            background-image: linear-gradient(rgba(0, 20, 0, 0.9), rgba(0, 20, 0, 0.9)), url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAEUlEQVQYV2NkoAAwMvz/z4AKAL8XAwWjT3L5AAAAAElFTkSuQmCC');
            background-size: cover, 4px 4px;
        }

        /* Container ch√≠nh v·ªõi vi·ªÅn ph√°t s√°ng */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(14, 17, 20, 0.95); /* B√°n trong su·ªët */
            padding: 25px;
            border: 1px solid var(--text-primary);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.15);
            position: relative;
        }
        /* Trang tr√≠ g√≥c container */
        .container::before { content: ""; position: absolute; top: -2px; left: -2px; width: 20px; height: 20px; border-top: 2px solid var(--text-accent); border-left: 2px solid var(--text-accent); }
        .container::after { content: ""; position: absolute; bottom: -2px; right: -2px; width: 20px; height: 20px; border-bottom: 2px solid var(--text-accent); border-right: 2px solid var(--text-accent); }


        /* --- Header & Status --- */
        .header {
            display: flex; gap: 15px;
            border-bottom: 2px solid var(--text-primary);
            padding-bottom: 20px; margin-bottom: 25px;
            align-items: center; letter-spacing: 1px;
        }
        .status { font-weight: 700; margin-left: auto; padding: 4px 8px; border: 1px solid currentColor; }
        .status.connected { color: var(--text-primary); box-shadow: inset 0 0 8px var(--text-primary); }
        .status.disconnected { color: var(--danger); box-shadow: inset 0 0 8px var(--danger); animation: blink-red 1s infinite; }

        /* --- Grid & Panels --- */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .full { grid-column: span 2; }
        
        .panel {
            border: 1px solid #333;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
            transition: border-color 0.3s;
        }
        .panel:hover { border-color: var(--text-accent); }
        
        h3 {
            margin-top: 0;
            border-bottom: 1px dashed #333;
            padding-bottom: 10px;
            color: var(--text-accent);
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        /* Th√™m ti·ªÅn t·ªë '>_' cho ti√™u ƒë·ªÅ */
        h3::before { content: ">_ "; color: var(--text-primary); }

        /* --- Inputs & Buttons (Terminal Style) --- */
        input[type="text"], input[type="number"] {
            padding: 8px;
            background: #000;
            border: 1px solid var(--text-primary);
            color: var(--text-primary);
            font-family: inherit;
            outline: none;
        }
        input:focus { border-color: var(--text-accent); box-shadow: 0 0 5px var(--text-accent); }

        button {
            padding: 8px 15px; cursor: pointer;
            background: transparent; /* N·ªÅn trong su·ªët */
            border: 1px solid currentColor; /* Vi·ªÅn theo m√†u ch·ªØ */
            color: var(--text-primary);
            font-family: inherit; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px;
            transition: all 0.2s;
            margin-right: 5px;
            position: relative; overflow: hidden;
        }
        /* Hi·ªáu ·ª©ng hover ƒë·∫£o m√†u */
        button:hover { background: var(--text-primary); color: #000; box-shadow: 0 0 10px var(--text-primary); }
        
        /* C√°c n√∫t m√†u ƒë·∫∑c bi·ªát */
        .btn-blue { color: var(--text-accent); }
        .btn-blue:hover { background: var(--text-accent); color: #000; box-shadow: 0 0 10px var(--text-accent); }
        .btn-red { color: var(--danger); }
        .btn-red:hover { background: var(--danger); color: #fff; box-shadow: 0 0 10px var(--danger); }
        .btn-green { color: var(--text-primary); }
        .btn-gray { color: #888; border-color: #888; }
        .btn-gray:hover { background: #888; color: #000; }

        /* --- Tables & Logs (Data Grid) --- */
        .scroll-box {
            height: 220px; overflow-y: auto; margin-top: 15px;
            border: 1px solid #333; background: #050505;
        }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th, td { border: 1px solid #222; padding: 8px; text-align: left; color: #bbb; }
        th { background: #111; position: sticky; top: 0; color: var(--text-accent); border-bottom: 1px solid var(--text-accent); }
        tr:hover td { color: var(--text-primary); background: rgba(0, 255, 65, 0.05); }
        
        textarea, #sys-log {
            width: 100%; background: #050505;
            color: var(--text-primary); border: 1px solid #333;
            padding: 10px; font-family: inherit; box-sizing: border-box;
        }
        textarea { height: 90px; resize: vertical; }
        textarea:focus { border-color: var(--text-primary); }
        
        #sys-log {
            height: 150px; overflow-y: auto; font-size: 12px;
            margin-top: 25px; border-top: 2px solid var(--text-accent);
        }
        #sys-log div { padding: 2px 0; border-bottom: 1px dotted #222; }
        /* Hi·ªáu ·ª©ng nh·∫•p nh√°y cho d√≤ng log cu·ªëi c√πng */
        #sys-log div:last-child::after { content: "_"; animation: blink 1s infinite; }

        /* --- Media Views --- */
        .view-area-container { border: 1px solid var(--text-primary); padding: 5px; display: inline-block; background: #000; }
        img.view-area {
            display: block; max-width: 100%; max-height: 350px;
            border: 1px solid #222; background: #0a0a0a;
            /* Hi·ªáu ·ª©ng nhi·ªÖu nh·∫π khi kh√¥ng c√≥ t√≠n hi·ªáu */
            min-height: 200px; min-width: 300px;
            background-image: repeating-linear-gradient(0deg, #0a0a0a, #0a0a0a 2px, #111 2px, #111 4px);
        }

        /* --- Animations --- */
        @keyframes blink { 50% { opacity: 0; } }
        @keyframes blink-red { 50% { opacity: 0.5; box-shadow: none; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <label for="ip" style="color: var(--text-accent); font-weight: bold;">[TARGET_IP]:></label> 
        <input type="text" id="ip" value="ws://localhost:9010" style="width: 200px;">
        <button class="btn-blue" onclick="connect()">[‚ö° ESTABLISH_LINK]</button>
        <span id="status" class="status disconnected">OFFLINE</span>
    </div>

    <div class="grid">
        <div class="panel full">
            <h3>üìπ SURVEILLANCE_FEED [Webcam]</h3>
            <div style="margin-bottom: 15px;">
                <button class="btn-green" onclick="send('WEBCAM', 'START_STREAM')">‚ñ∂ ACTIVATE FEED</button>
                <button class="btn-red" onclick="send('WEBCAM', 'STOP_STREAM')">‚ñ† TERMINATE FEED</button>
            </div>
            <div class="view-area-container" style="width: 100%; text-align: center;">
                <img id="cam-stream" class="view-area" style="margin: 0 auto;" alt="> NO SIGNAL <">
            </div>
        </div>

        <div class="panel">
            <h3>‚öôÔ∏è ACTIVE_PROCESSES</h3>
            <div style="margin-bottom: 12px; border-bottom: 1px dashed #333; padding-bottom: 10px;">
                <input type="text" id="proc-path" placeholder="ex: cmd.exe" style="width: 140px;">
                <button class="btn-green" onclick="startProcess()">> EXECUTE</button>
            </div>
            
            <div style="margin-bottom: 12px;">
                <button class="btn-blue" onclick="send('PROCESS', 'LIST')">‚Üª REFRESH_LIST</button>
                <input type="number" id="proc-pid" placeholder="PID" style="width: 80px;">
                <button class="btn-red" onclick="killProcess()">X KILL_PID</button>
            </div>

            <div class="scroll-box">
                <table id="proc-table">
                    <thead><tr><th>PID</th><th>IMAGE_NAME</th><th>THRDS</th><th>ACT</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="panel">
            <h3>üì¶ REGISTERED_APPLICATIONS</h3>
            <div style="margin-bottom: 12px;">
                <button class="btn-blue" onclick="send('APP', 'LIST')">‚Üª SCAN_APPS</button>
                <input type="text" id="app-path" placeholder="App Name" style="width: 100px;">
                <button class="btn-green" onclick="startApp()">> LAUNCH</button>
            </div>
            <div class="scroll-box">
                <table id="app-table">
                    <thead><tr><th>EXECUTABLE</th><th>ACTION</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="panel">
            <h3>üì∏ DESKTOP_SNAPSHOT</h3>
            <button class="btn-green" onclick="captureScreen()" style="width: 100%; margin-bottom: 10px;">[ CAPTURE_FRAME ]</button>
            <div class="view-area-container" style="width: 100%;">
                <img id="screen-img" class="view-area" style="max-height: 180px; width: 100%;" alt="> NO DATA <">
            </div>
        </div>

        <div class="panel">
            <h3>‚å®Ô∏è KEYSTROKE_INTERCEPT</h3>
            <div style="margin-bottom: 10px;">
                <button class="btn-red" onclick="send('KEYBOARD', 'START')">‚óè REC</button>
                <button class="btn-gray" onclick="send('KEYBOARD', 'STOP')">‚ñ† STOP</button>
                <button class="btn-blue" onclick="document.getElementById('keylog-out').value=''">_CLEAR</button>
            </div>
            <textarea id="keylog-out" placeholder="> Waiting for input stream..."></textarea>
        </div>
        
        <div class="panel full" style="border-color: var(--danger);">
            <h3 style="color: var(--danger);">üñ•Ô∏è SYSTEM_POWER_OPS [DANGER ZONE]</h3>
            <button class="btn-red" onclick="if(confirm('Confirm SYSTEM HALT?')) send('SYSTEM', 'SHUTDOWN')">üõë INITIATE_SHUTDOWN</button>
            <button class="btn-gray" onclick="if(confirm('Confirm SYSTEM REBOOT?')) send('SYSTEM', 'RESTART')">üîÑ INITIATE_RESTART</button>
        </div>
    </div>

    <div id="sys-log">
        <div>>_ SYSTEM READY. Waiting for connection target...</div>
    </div>
</div>

<script>
    // ... (Copy to√†n b·ªô n·ªôi dung th·∫ª <script> t·ª´ code c≈© c·ªßa em v√†o ƒë√¢y, kh√¥ng c·∫ßn s·ª≠a g√¨) ...
    let ws = null;
    const logDiv = document.getElementById('sys-log');
    
    // C·ªù quan tr·ªçng: Ph√¢n bi·ªát g√≥i binary ƒë·∫øn l√† ·∫¢nh ch·ª•p m√†n h√¨nh hay Video stream
    let isWaitingForScreenshot = false;

    function log(msg) {
        const div = document.createElement('div');
        div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
        logDiv.appendChild(div);
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    function connect() {
        if (ws) { ws.close(); ws = null; }
        ws = new WebSocket(document.getElementById('ip').value);
        ws.binaryType = "arraybuffer"; // B·∫Øt bu·ªôc cho Binary Mode

        ws.onopen = () => {
            document.getElementById('status').className = "status connected";
            document.getElementById('status').innerText = "ONLINE"; // S·ª≠a text m·ªôt ch√∫t cho ng·∫ßu
            log("‚úÖ >>> CONNECTION ESTABLISHED <<<");
        };
        ws.onclose = () => {
            document.getElementById('status').className = "status disconnected";
            document.getElementById('status').innerText = "OFFLINE";
            log("‚ùå >>> CONNECTION LOST <<<");
        };

        ws.onmessage = (event) => {
            // 1. X·ª¨ L√ù D·ªÆ LI·ªÜU NH·ªä PH√ÇN (BINARY)
            if (event.data instanceof ArrayBuffer) {
                if (isWaitingForScreenshot) {
                    // N·∫øu ƒëang ƒë·ª£i Screenshot -> Hi·ªÉn th·ªã v√†o khung Screenshot
                    renderImage('screen-img', event.data);
                    isWaitingForScreenshot = false; // Reset c·ªù
                    log("üì∏ > Screenshot frame received.");
                } else {
                    // M·∫∑c ƒë·ªãnh l√† Stream Webcam
                    renderImage('cam-stream', event.data);
                }
                return;
            }

            // 2. X·ª¨ L√ù D·ªÆ LI·ªÜU VƒÇN B·∫¢N (JSON)
            try {
                const res = JSON.parse(event.data);
                handleResponse(res);
            } catch (e) {
                console.error("JSON Parse Error", e);
            }
        };
    }

    // Render ·∫£nh t·ª´ ArrayBuffer d√πng Blob URL (Hi·ªáu nƒÉng cao)
    let urlCache = {};
    function renderImage(elementId, buffer) {
        const blob = new Blob([buffer], { type: "image/jpeg" });
        const url = URL.createObjectURL(blob);
        const img = document.getElementById(elementId);
        
        img.onload = () => {
            if (urlCache[elementId]) URL.revokeObjectURL(urlCache[elementId]);
            urlCache[elementId] = url;
        };
        img.src = url;
    }

    // --- G·ª¨I L·ªÜNH ---
    function send(module, command, payload = {}) {
        if (!ws || ws.readyState !== 1) { alert(">>> ERROR: NO CARRIER (Check connection) <<<"); return; }
        const msg = { module, command, payload };
        ws.send(JSON.stringify(msg));
        log(`> SENDING: [${module}::${command}]`);
    }

    // --- UI ACTIONS ---
    function captureScreen() {
        isWaitingForScreenshot = true; // B·∫≠t c·ªù ƒë·ª£i ·∫£nh
        send('SCREEN', 'CAPTURE_BINARY');
    }

    function killProcess() {
        const pid = document.getElementById('proc-pid').value;
        if(pid) send('PROCESS', 'KILL', { pid: parseInt(pid) });
    }
// Th√™m h√†m n√†y v√†o v√πng <script>
    function startProcess() {
        const path = document.getElementById('proc-path').value;
        if (path) {
            // G·ª≠i l·ªánh PROCESS -> START k√®m payload path
            send('PROCESS', 'START', { path: path });
        } else {
            alert("Please enter process path/name!");
        }
    }
    function startApp() {
        const path = document.getElementById('app-path').value;
        if(path) send('APP', 'START', { path: path });
    }

    // --- X·ª¨ L√ù JSON RESPONSE ---
    function handleResponse(res) {
        if (res.status === 'error') { log("‚õî ERROR: " + res.message); return; }

        // PROCESS LIST
        if (res.module === 'PROCESS' && res.command === 'LIST') {
            const tbody = document.querySelector('#proc-table tbody');
            tbody.innerHTML = "";
            const list = (res.data && res.data.process_list) ? res.data.process_list : [];
            
            list.slice(0, 300).forEach(p => {
                const row = tbody.insertRow();
                row.insertCell().innerText = p.pid;
                row.insertCell().innerText = p.name;
                row.insertCell().innerText = p.threads;
                
                const btn = document.createElement('button');
                btn.innerText = "X";
                btn.className = "btn-red";
                btn.style.padding = "2px 6px";
                btn.style.border = "none"; btn.style.background = "var(--danger)"; btn.style.color = "black"; // Ghi ƒë√® style n√∫t X trong b·∫£ng cho g·ªçn
                btn.onclick = () => { document.getElementById('proc-pid').value = p.pid; };
                row.insertCell().appendChild(btn);
            });
            log(`> Process list updated: ${list.length} entries.`);
        }

        // APP LIST
        else if (res.module === 'APP' && res.command === 'LIST') {
            const tbody = document.querySelector('#app-table tbody');
            tbody.innerHTML = "";
            (res.apps || []).forEach(app => {
                const row = tbody.insertRow();
                row.insertCell().innerText = app.exe;
                const btn = document.createElement('button');
                btn.innerText = "KILL"; 
                btn.className = "btn-red"; btn.style.fontSize = "10px";
                btn.onclick = () => send('APP', 'KILL', { name: app.exe });
                row.insertCell().appendChild(btn);
            });
            log(`> App list updated.`);
        }

        // KEYLOGGER
        else if (res.module === 'KEYBOARD' && res.command === 'PRESS') {
            let k = res.data.key;
            if(k === '[ENTER]') k = '\n';
            const txt = document.getElementById('keylog-out');
            txt.value += k;
            txt.scrollTop = txt.scrollHeight;
        }
        
        else {
            log(`‚ÑπÔ∏è [${res.module}] ACK: ${res.message || 'OK'}`);
        }
    }
</script>
</body>
</html>